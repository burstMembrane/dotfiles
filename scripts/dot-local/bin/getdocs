#!/usr/bin/env bash
set -euo pipefail

if [ $# -lt 1 ]; then
  echo "Usage: $0 <url> [output_dir]" >&2
  exit 1
fi

URL="$1"
OUTDIR="${2:-.}"

# Create output directory if it doesn't exist
mkdir -p "$OUTDIR"

# Generate a safe filename from the URL
FILENAME="$(echo "$URL" | sed 's~https\?://~~; s#[/?&=]#_#g; s/_$//').md"
OUTPATH="${OUTDIR%/}/$FILENAME"

# Fetch and convert
lynx -dump -nolist "$URL" > "$OUTPATH"

echo "Saved markdown to: $OUTPATH"
